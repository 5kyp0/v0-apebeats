# ApeBeats Genesis Deployment Guide

This guide covers deploying and testing the ApeBeats Genesis NFT contracts on Curtis Testnet and preparing for mainnet deployment.

## Prerequisites

1. **Node.js and pnpm**: Make sure you have Node.js installed and use pnpm for package management
2. **APE tokens**: Get testnet APE tokens from Curtis Testnet faucet
3. **Private key**: Have a wallet with testnet APE for deployment

## Quick Start

### 1. Install Dependencies

```bash
pnpm install
```

### 2. Environment Setup

Configure your `.env.local` file with the following template:

```bash
# ApeBeats Genesis - Curtis Testnet Configuration
# Fill in the values below before deployment

# ===========================================
# DEPLOYMENT CONFIGURATION
# ===========================================
# Your wallet's private key for deployment
# ‚ö†Ô∏è  NEVER commit this to version control!
# Get this from your wallet (MetaMask, etc.)
PRIVATE_KEY=your_private_key_here

# ===========================================
# NETWORK CONFIGURATION
# ===========================================
# Curtis Testnet settings (already configured)
NEXT_PUBLIC_CHAIN_ID=33111
NEXT_PUBLIC_CHAIN_NAME=Curtis Testnet
NEXT_PUBLIC_RPC_URL=https://rpc.curtis.apechain.xyz
NEXT_PUBLIC_EXPLORER_URL=https://explorer.curtis.apechain.xyz

# ===========================================
# CONTRACT ADDRESSES (Auto-filled after deployment)
# ===========================================
# These will be automatically filled when you run: pnpm run deploy:curtis
NEXT_PUBLIC_APEBEATS_GENESIS_ADDRESS=
NEXT_PUBLIC_APEBEATS_METADATA_LIB_ADDRESS=
NEXT_PUBLIC_APEBEATS_ROYALTIES_ADDRESS=

# ===========================================
# WHITELIST CONFIGURATION
# ===========================================
# Delegate.xyz registry (using mainnet address)
NEXT_PUBLIC_DELEGATE_REGISTRY_ADDRESS=0x00000000000000447e69651d841bd8d104bed493

# Merkle roots for whitelist phases
# Generate these by running: pnpm run generate:merkle
NEXT_PUBLIC_GTD_MERKLE_ROOT=
NEXT_PUBLIC_FCFS_MERKLE_ROOT=

# ===========================================
# PROJECT ADDRESSES
# ===========================================
# Treasury and founder addresses (usually your wallet)
# These will be auto-filled during deployment
NEXT_PUBLIC_TREASURY_ADDRESS=
NEXT_PUBLIC_FOUNDER_ADDRESS=
```

**Important Notes:**
- Replace `your_private_key_here` with your actual private key
- Get testnet APE tokens from Curtis Testnet faucet
- Contract addresses will be filled automatically after deployment
- Merkle roots will be filled after generating whitelist

### 3. Generate Merkle Trees (Optional)

If you have a whitelist, generate Merkle trees:

```bash
pnpm run generate:merkle
```

This will create:
- `merkle/whitelist.json` - Merkle tree data
- `lib/merkle.ts` - TypeScript types for frontend
- `scripts/verify-merkle.js` - Verification script

**Note**: Update the whitelist addresses in `scripts/generate-merkle.js` before running this command.

### 4. Deploy Contracts

Deploy to Curtis Testnet:

```bash
pnpm run deploy:curtis
```

This will:
- Deploy all three contracts (Genesis, MetadataLib, Royalties)
- Initialize the contracts
- **Automatically update your `.env.local`** with contract addresses
- Save deployment info to `deployments/curtis-testnet.json`

### 5. Test Contracts

Test the deployed contracts:

```bash
pnpm run test:contracts
```

### 6. Start Local Development

Start the Next.js development server:

```bash
pnpm dev
```

Visit `http://localhost:3000/mint` to test the mint page.

## üîß Environment Variables Reference

### Where to Get Values

| Variable | Where to Get | Example |
|----------|-------------|---------|
| `PRIVATE_KEY` | Your wallet (MetaMask, etc.) | `0x1234...` |
| `NEXT_PUBLIC_APEBEATS_GENESIS_ADDRESS` | Auto-filled after deployment | `0xABC123...` |
| `NEXT_PUBLIC_GTD_MERKLE_ROOT` | Generated by `pnpm run generate:merkle` | `0xDEF456...` |
| `NEXT_PUBLIC_TREASURY_ADDRESS` | Your wallet address | `0x789ABC...` |

### Security Notes

- **NEVER commit `.env.local`** to version control
- **NEVER share your private key** with anyone
- **Use testnet first** before mainnet deployment
- **Verify all addresses** before deployment

## Contract Architecture

### ApeBeatsGenesis.sol
- Main NFT contract (ERC721)
- Handles all minting phases (Founder, GTD, FCFS, Public)
- Integrates with Delegate.xyz for vault support
- Manages royalties and metadata

### ApeBeatsMetadataLib.sol
- Manages token metadata and reveal process
- Stores audio loop data and waveform information
- Generates on-chain metadata with rarity scores

### ApeBeatsRoyalties.sol
- Handles royalty distribution
- Tracks original minters for royalty claims
- Manages pool royalties for community distribution

## Minting Phases

1. **Founder Mint** (4 NFTs, Free)
   - Only founder can mint
   - Auto-transitions to GTD phase when complete

2. **GTD Mint** (42 NFTs, 4.2 APE each)
   - Guaranteed mint for whitelisted addresses
   - 1 per wallet, 15-minute duration
   - Requires Merkle proof

3. **FCFS Mint** (Unlimited, 6.9 APE each)
   - First-come-first-served for whitelisted addresses
   - Up to 4 per wallet, 30-minute duration
   - Requires Merkle proof

4. **Public Mint** (Until sold out, 6.9 APE each)
   - Open to everyone
   - Up to 5 per wallet
   - No whitelist required

## Configuration

### Network Configuration

**Curtis Testnet:**
- Chain ID: 33111
- RPC: https://rpc.curtis.apechain.xyz
- Explorer: https://explorer.curtis.apechain.xyz

**ApeChain Mainnet:**
- Chain ID: 33144
- RPC: https://rpc.apechain.xyz
- Explorer: https://explorer.apechain.xyz

### Contract Constants

- Total Supply: 420 NFTs
- Founder Mint: 4 NFTs (free)
- GTD Mint: 42 NFTs (4.2 APE each)
- Royalty: 4.2% (420 basis points)
- GTD Duration: 15 minutes
- FCFS Duration: 30 minutes

## Available Scripts

### Core Scripts

| Script | Command | Description |
|--------|---------|-------------|
| Setup | `pnpm run setup` | Initialize project and create directories |
| Deploy | `pnpm run deploy` | Deploy contracts to Curtis Testnet |
| Deploy Mainnet | `pnpm run deploy:mainnet` | Deploy contracts to ApeChain Mainnet |
| Test | `pnpm run test:contracts` | Test deployed contracts |
| Generate Assets | `pnpm run generate:assets` | Generate audio assets and waveforms |
| Generate Metadata | `pnpm run generate:metadata` | Generate NFT metadata and rarity analysis |
| Generate Merkle | `pnpm run generate:merkle` | Generate Merkle trees for whitelist |
| Update Merkle | `pnpm run update:merkle` | Update Merkle roots in contracts |
| Reveal | `pnpm run reveal` | Reveal NFTs and set metadata |
| Withdraw | `pnpm run withdraw` | Withdraw funds from contracts |
| Verify Merkle | `pnpm run verify:merkle` | Verify Merkle proof validity |

### Complete Workflow

1. **Initial Setup**:
   ```bash
   pnpm run setup
   # Add private key to .env.local
   # Get testnet APE tokens
   ```

2. **Deploy and Test**:
   ```bash
   pnpm run deploy
   pnpm run test:contracts
   ```

3. **Prepare for Launch**:
   ```bash
   pnpm run generate:assets
   pnpm run generate:metadata
   pnpm run generate:merkle
   pnpm run update:merkle
   ```

4. **After Minting**:
   ```bash
   pnpm run reveal
   ```

5. **Withdraw Funds**:
   ```bash
   pnpm run withdraw
   ```

## Testing

### Local Testing

1. Start local Hardhat network:
```bash
npx hardhat node
```

2. Deploy to local network:
```bash
npx hardhat run scripts/deploy.js --network localhost
```

3. Test contracts:
```bash
npx hardhat run scripts/test-contracts.js --network localhost
```

### Testnet Testing

1. Deploy to Curtis Testnet:
```bash
pnpm run deploy
```

2. Test contracts:
```bash
pnpm run test:contracts
```

3. Test mint page locally:
```bash
pnpm dev
```

## Mainnet Deployment

### Preparation

1. Update Merkle roots with final whitelist
2. Set up IPFS for metadata storage
3. Configure audio loop data in MetadataLib
4. Test thoroughly on testnet

### Deployment

1. Update environment variables for mainnet
2. Deploy contracts:
```bash
pnpm run deploy:mainnet
```

3. Verify contracts on explorer
4. Update frontend with mainnet addresses

## Troubleshooting

### Common Issues

1. **Insufficient Gas**: Increase gas limit in deployment script
2. **Merkle Proof Errors**: Regenerate Merkle trees with correct addresses
3. **Contract Initialization**: Ensure all parameters are correct
4. **Network Issues**: Check RPC URL and network configuration

### Debug Commands

```bash
# Compile contracts
pnpm run compile

# Clean artifacts
pnpm run clean

# Verify Merkle proofs
pnpm run verify:merkle

# Check deployment status
cat deployments/curtis-testnet.json
```

## Security Considerations

1. **Private Keys**: Never commit private keys to version control
2. **Merkle Roots**: Verify Merkle roots before deployment
3. **Contract Ownership**: Ensure proper ownership transfer if needed
4. **Royalty Configuration**: Verify royalty settings
5. **Access Control**: Test all access control functions

## Support

For issues or questions:
1. Check the deployment logs
2. Verify contract addresses in `.env.local`
3. Test on Curtis Testnet first
4. Review contract source code

## Next Steps

After successful testnet deployment:
1. Test all minting phases
2. Verify metadata generation
3. Test royalty distribution
4. Prepare for mainnet deployment
5. Set up monitoring and analytics
